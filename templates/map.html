<!DOCTYPE html>
<html lang="en">
<head>
	<title>食安餐廳系統</title>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="../static/bootstrap-4.2.1-dist/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="../static/css/map.css">
	<link rel="stylesheet" type="text/css" href="../static/css/menu.css">
	<script src="../static/js/jquery-3.6.0.js"></script>
	<script src="../static/bootstrap-4.2.1-dist/js/bootstrap.min.js"></script>
	<!-- icons -->
	<script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
    
    <!--怎麼插github阿-->
    <script src="../static/js/jquery.csv.min.js"></script>

    <!-- 地圖api API key AIzaSyAb22ZqUxgWeBLNhIJ_C3GnlEx_m8jk-9Y-->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAb22ZqUxgWeBLNhIJ_C3GnlEx_m8jk-9Y&callback=initMap&libraries=&v=weekly" async></script>
</head>

<body id="page-top">
    <nav id="menu" class="navbar navbar-expand-lg fixed-top align-self-start">
		<a class="navbar-brand" href="#page-top"><img class="w-80 ml-3" src="../static/images/title img.png"></a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i class="fas fa-bars" style="color: #fff;"></i></button>
		<div class="collapse navbar-collapse justify-content-end" id="navbarResponsive">
			<ul class="navbar-nav text-center">
				<li class="nav-item"><a class="nav-link" href="./index.html">首頁</a></li>
				<li class="nav-item"><a class="nav-link active" href="./map">地圖</a></li>
				<li class="nav-item"><a class="nav-link" href="./news">食安新聞</a></li>
				<li class="nav-item"><a class="nav-link" href="./greenresturant">綠色餐廳</a></li>
				<li class="nav-item"><a class="nav-link" href="./login"><i class="fas fa-user"></i></a></li>
			</ul>
		</div>
	</nav>

	<div class="container-fluid">
		<section class="first">
			<div class="row align-items-center">
				<div class="col-lg-5 text-center">
					<!-- 搜尋框 -->
					<div class="form-group">
						<form class="form-inline">
							<!--輸入餐廳框框-->
							<input name="address" class="form-control col-lg-5" type="text" placeholder="搜尋餐廳">
							<button type="submit" class="btn btn-primary" name="search">搜尋</button>
						</form>
					</div>
				</div>
				<div class="col-lg-2">
					<!--分類框-->
					<div class="class-restaurant">
						分類
					</div>
				</div>
			</div>
			
	
			<!--地圖-->
			<div id="map"></div>
		</section>
		
	</div>

	
	<footer class="footer py-2">
		<div class="row align-items-center">
			<div class="col-lg-4 text-lg-start"></div>
			<div class="col-lg-4 my-3 my-lg-0"></div>
			<div class="col-lg-4 text-lg-end text-right">
				<ul class="footer-link">
					<li class="nav-item"><a class="nav-link" href="./about">關於我們</a></li>
					<li class="nav-item"><a class="nav-link" href="./userinfo">使用者頁面</a></li>
				</ul>
			</div>
		</div>
	</footer>

	<script >
		

		let map;
		function initMap() {
			map = new google.maps.Map(document.getElementById("map"), {
				center: { 
					lat: 23.695919378044756, 
					lng: 120.53353474084176
				},
				zoom: 16,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			});


			var marker = [];
    		var infoWindow = [];
			var pigdata=[];


			console.log('{{data.0.market_name}}') //陣列第一筆資料ㄉmarket_name

			//轉存資料給js使用
			for (i = 0; i< data.length; i++) {
				
			}

			console.log(pigdata); 

			// pigdata = {
			// 		market_name: '{{data.market_name}}',
			// 		addr:'{{data.addr}}',
			// 		context:'{{data.context}}',
			// 		Latitude:'{{data.Latitude}}',
			// 		Lontitude: '{{data.Lontitude}}',
			// 	};

			//測試 console.log(pigdata); 

			//地標資料處理(這邊會換dbㄉ資料)
			var markerData = [
				{
					position: new google.maps.LatLng(pigdata['Latitude'], pigdata['Lontitude']), //位置
					title: pigdata['market_name'], //名稱
					content: pigdata['context'], //內容
				},

				{
					position: new google.maps.LatLng(23.6894251, 120.529039), //位置
					title: '科大傳奇', //名稱
					content: '我家', //內容
				},

				{
					position: new google.maps.LatLng(23.6948919, 120.5275102),
					title: '萊爾富',
					content: 'ㄚ就萊爾富',
				}
			];
			
			//地標圖片，圖片88 我頭會痛死要重調惹QAQ
			const icons = {
				pig: "./static/images/pig.png",
				green:"./static/images/green.png",
				free:"./static/images/free.png",
				evaluation:"./static/images/evaluation.png",
			};


			//跑迴圈新增地標
			for (i = 0; i< markerData.length; i++) {
				marker[i] = new google.maps.Marker({
					position: markerData[i].position,
					map: map,
					title: markerData[i].title,
					icon: icons['pig'], //這邊我先弄豬而已
					});
				
					infoWindow[i] = new google.maps.InfoWindow({ // 按下地標跑出的內容設定
					content: '<div class="map_content text-center p-2">' + '<p class="map_content_title">' +markerData[i]['title']+'</p><p>'+ markerData[i]['content'] + '</p>'
						+'</div>'
				});

            	markerEvent(i);
            }
            
            // 點地標，跑出訊息框
            function markerEvent(i) {
              marker[i].addListener('click', function() {
                infoWindow[i].open(map, marker[i]);
              });
            }
			

		}
	</script>


</body>
</html>